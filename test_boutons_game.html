
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Boutons - Game.html</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0f172a;
            color: #f1f5f9;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #1e293b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
        }
        .test-title {
            color: #22c55e;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        button {
            background: #22c55e;
            color: #0f172a;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        button:hover {
            opacity: 0.8;
        }
        pre {
            background: #0f172a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .code-block {
            background: #0a0f1e;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #3b82f6;
        }
    </style>
</head>
<body>
    <h1>üîç Diagnostic des boutons - game.html</h1>

    <div class="test-section">
        <div class="test-title">1. V√©rifier que les fonctions existent</div>
        <button onclick="testFunctionsExist()">Tester les fonctions</button>
        <div id="functions-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">2. V√©rifier les boutons dans le DOM</div>
        <button onclick="testButtonsInDOM()">Tester les boutons</button>
        <div id="buttons-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">3. Tester le localStorage</div>
        <button onclick="testLocalStorage()">V√©rifier localStorage</button>
        <div id="storage-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">4. Simulation de saveGameSettings</div>
        <button onclick="testSaveGameSettings()">Simuler sauvegarde</button>
        <div id="save-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">5. Simulation de toggleSearch</div>
        <button onclick="testToggleSearch()">Simuler recherche</button>
        <div id="search-result"></div>
    </div>

    <div class="test-section">
        <div class="test-title">6. Console JavaScript</div>
        <div class="code-block">
            <p>Ouvrez la console (F12) et tapez :</p>
            <pre>// Sur la vraie page game.html
console.log('saveGameSettings:', typeof saveGameSettings);
console.log('toggleSearch:', typeof toggleSearch);
console.log('userGameData:', userGameData);</pre>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">7. Instructions de correction</div>
        <button onclick="showFix()">Voir les corrections</button>
        <div id="fix-instructions"></div>
    </div>

    <script>
        function testFunctionsExist() {
            const resultDiv = document.getElementById('functions-result');

            // Simuler l'environnement de game.html
            const functions = [
                'saveGameSettings',
                'toggleSearch',
                'selectRank',
                'togglePrefRank',
                'updateMainMode',
                'toggleOption'
            ];

            let html = '<h3>Sur cette page de test :</h3>';
            html += '<ul>';

            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                const status = exists ? '<span class="success">‚úÖ Existe</span>' : '<span class="error">‚ùå N\'existe pas</span>';
                html += `<li>${funcName}: ${status}</li>`;
            });

            html += '</ul>';
            html += '<p class="warning">‚ö†Ô∏è Ces fonctions doivent √™tre test√©es sur la vraie page game.html</p>';
            html += '<p>Ouvrez game.html et tapez dans la console (F12) :</p>';
            html += '<pre>console.log(typeof saveGameSettings);  // Devrait afficher "function"<br>console.log(typeof toggleSearch);      // Devrait afficher "function"</pre>';

            resultDiv.innerHTML = html;
        }

        function testButtonsInDOM() {
            const resultDiv = document.getElementById('buttons-result');

            let html = '<h3>√âl√©ments √† v√©rifier dans game.html :</h3>';
            html += '<div class="code-block">';
            html += '<p>1. Bouton "Mettre √† jour mes infos" :</p>';
            html += '<pre>&lt;button class="update-btn" onclick="saveGameSettings()"&gt;</pre>';
            html += '<p>2. Bouton "Rechercher un partenaire" :</p>';
            html += '<pre>&lt;button id="partnerSearchButton" onclick="toggleSearch()"&gt;</pre>';
            html += '</div>';

            html += '<h3>Test √† faire sur game.html :</h3>';
            html += '<pre>';
            html += '// Dans la console (F12) de game.html\n';
            html += 'const updateBtn = document.querySelector(\'.update-btn\');\n';
            html += 'console.log(\'Update button:\', updateBtn);\n';
            html += 'console.log(\'onclick:\', updateBtn?.onclick);\n\n';
            html += 'const searchBtn = document.getElementById(\'partnerSearchButton\');\n';
            html += 'console.log(\'Search button:\', searchBtn);\n';
            html += 'console.log(\'onclick:\', searchBtn?.onclick);\n';
            html += '</pre>';

            resultDiv.innerHTML = html;
        }

        function testLocalStorage() {
            const resultDiv = document.getElementById('storage-result');

            const token = localStorage.getItem('token');
            const username = localStorage.getItem('username');

            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr style="border-bottom: 1px solid #334155;"><th style="text-align: left; padding: 5px;">Cl√©</th><th style="text-align: left; padding: 5px;">Statut</th></tr>';

            html += `<tr><td style="padding: 5px;">token</td><td style="padding: 5px;">${token ? '<span class="success">‚úÖ Pr√©sent</span>' : '<span class="error">‚ùå Absent (vous devez √™tre connect√©)</span>'}</td></tr>`;
            html += `<tr><td style="padding: 5px;">username</td><td style="padding: 5px;">${username ? `<span class="success">‚úÖ ${username}</span>` : '<span class="error">‚ùå Absent</span>'}</td></tr>`;

            html += '</table>';

            if (!token) {
                html += '<p class="error">‚ö†Ô∏è IMPORTANT : Vous devez √™tre connect√© pour utiliser les boutons !</p>';
                html += '<p>1. Allez sur <a href="/login.html" style="color: #22c55e;">la page de connexion</a></p>';
                html += '<p>2. Connectez-vous avec votre compte</p>';
                html += '<p>3. Retournez sur game.html</p>';
            }

            resultDiv.innerHTML = html;
        }

        function testSaveGameSettings() {
            const resultDiv = document.getElementById('save-result');

            let html = '<h3>Probl√®mes potentiels et solutions :</h3>';
            html += '<div class="code-block">';

            html += '<h4>Probl√®me 1 : Fonction non d√©finie</h4>';
            html += '<p class="warning">Sympt√¥me : "saveGameSettings is not defined"</p>';
            html += '<p>Solution : V√©rifier que window.saveGameSettings est bien d√©fini (ligne 841 de game.html)</p>';

            html += '<h4>Probl√®me 2 : userGameData vide</h4>';
            html += '<p class="warning">Sympt√¥me : Alert "Veuillez s√©lectionner votre rang"</p>';
            html += '<p>Solution : S√©lectionner un rang et un mode avant de sauvegarder</p>';

            html += '<h4>Probl√®me 3 : Pas de r√©ponse</h4>';
            html += '<p class="warning">Sympt√¥me : Rien ne se passe au clic</p>';
            html += '<p>Solutions possibles :</p>';
            html += '<ul>';
            html += '<li>V√©rifier la console (F12) pour les erreurs</li>';
            html += '<li>V√©rifier que vous √™tes connect√© (token pr√©sent)</li>';
            html += '<li>V√©rifier que le serveur est d√©marr√©</li>';
            html += '<li>V√©rifier l\'attribut onclick du bouton</li>';
            html += '</ul>';

            html += '</div>';

            resultDiv.innerHTML = html;
        }

        function testToggleSearch() {
            const resultDiv = document.getElementById('search-result');

            let html = '<h3>Probl√®mes potentiels et solutions :</h3>';
            html += '<div class="code-block">';

            html += '<h4>Probl√®me 1 : Fonction non d√©finie</h4>';
            html += '<p class="warning">Sympt√¥me : "toggleSearch is not defined"</p>';
            html += '<p>Solution : V√©rifier que window.toggleSearch est bien d√©fini (ligne 889 de game.html)</p>';

            html += '<h4>Probl√®me 2 : Pas de settings</h4>';
            html += '<p class="warning">Sympt√¥me : Alert "Veuillez d√©finir votre rang"</p>';
            html += '<p>Solution : D\'abord "Mettre √† jour mes infos" avant de rechercher</p>';

            html += '<h4>Probl√®me 3 : API en erreur</h4>';
            html += '<p class="warning">Sympt√¥me : Spinner qui ne s\'arr√™te pas</p>';
            html += '<p>Solutions :</p>';
            html += '<ul>';
            html += '<li>V√©rifier que le serveur est d√©marr√©</li>';
            html += '<li>V√©rifier l\'API /api/match/search/{gameId}</li>';
            html += '<li>Regarder les logs du serveur</li>';
            html += '</ul>';

            html += '</div>';

            resultDiv.innerHTML = html;
        }

        function showFix() {
            const resultDiv = document.getElementById('fix-instructions');

            let html = '<h3>üîß Plan de correction :</h3>';
            html += '<div class="code-block">';

            html += '<h4>√âtape 1 : V√©rifier l\'environnement</h4>';
            html += '<pre>';
            html += '# Le serveur est-il d√©marr√© ?\n';
            html += 'node server.js\n\n';
            html += '# √ätes-vous connect√© ?\n';
            html += '# Allez sur /login.html et connectez-vous';
            html += '</pre>';

            html += '<h4>√âtape 2 : Ouvrir game.html</h4>';
            html += '<pre>http://localhost:3000/csgo\n';
            html += '# ou\n';
            html += 'http://localhost:3000/fortnite\n';
            html += '# ou\n';
            html += 'http://localhost:3000/lol</pre>';

            html += '<h4>√âtape 3 : Ouvrir la console (F12)</h4>';
            html += '<p>Taper ces commandes dans la console :</p>';
            html += '<pre>';
            html += '// V√©rifier les fonctions\n';
            html += 'console.log(typeof saveGameSettings);  // "function"\n';
            html += 'console.log(typeof toggleSearch);      // "function"\n\n';
            html += '// V√©rifier les boutons\n';
            html += 'const updateBtn = document.querySelector(\'.update-btn\');\n';
            html += 'console.log(\'Update button:\', updateBtn);\n\n';
            html += 'const searchBtn = document.getElementById(\'partnerSearchButton\');\n';
            html += 'console.log(\'Search button:\', searchBtn);\n\n';
            html += '// Tester manuellement\n';
            html += 'saveGameSettings();  // Devrait afficher alert\n';
            html += 'toggleSearch();      // Devrait lancer la recherche\n';
            html += '</pre>';

            html += '<h4>√âtape 4 : Si les fonctions ne sont pas d√©finies</h4>';
            html += '<p class="error">Il y a une erreur JavaScript qui emp√™che le chargement</p>';
            html += '<p>Cherchez les erreurs en rouge dans la console</p>';

            html += '<h4>√âtape 5 : Si "token absent"</h4>';
            html += '<p class="warning">Vous devez vous reconnecter</p>';
            html += '<pre>localStorage.getItem(\'token\');  // Doit retourner une cha√Æne</pre>';

            html += '</div>';

            resultDiv.innerHTML = html;
        }

        // Auto-test au chargement
        window.addEventListener('load', function() {
            console.log('üìã Page de test charg√©e');
            console.log('Token:', localStorage.getItem('token') ? '‚úÖ Pr√©sent' : '‚ùå Absent');
        });
    </script>
</body>
</html>
